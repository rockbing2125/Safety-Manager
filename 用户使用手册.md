# Safety Manager 用户使用手册

## 欢迎使用并网法规管理系统

本手册将帮助你快速上手使用 Safety Manager。

---

## 目录

1. [快速开始](#快速开始)
2. [系统登录](#系统登录)
3. [法规管理](#法规管理)
4. [代码管理](#代码管理)
5. [搜索功能](#搜索功能)
6. [用户管理](#用户管理)
7. [系统设置](#系统设置)
8. [常见问题](#常见问题)

---

## 快速开始

### 系统要求

- **操作系统**: Windows 10 或更高版本
- **内存**: 4GB 及以上（推荐 8GB）
- **磁盘空间**: 至少 500MB 可用空间
- **屏幕分辨率**: 1280x720 或更高

### 安装步骤

1. **下载软件**
   - 从 GitHub 下载最新版本
   - 或从管理员处获取安装包

2. **解压文件**
   ```
   右键点击 zip 文件 → 解压到文件夹
   建议位置：C:\Program Files\SafetyManager\
   ```

3. **启动程序**
   ```
   双击 SafetyManager.exe
   ```

4. **首次运行**
   - 程序会自动初始化数据库
   - 等待几秒钟直到登录界面出现

---

## 系统登录

### 默认账户

首次安装后使用默认管理员账户：

```
用户名: admin
密码: admin123
```

### 登录步骤

1. 输入用户名和密码
2. 点击"登录"按钮
3. 成功后进入主界面

### 首次登录必做

⚠️ **重要**：登录后立即修改默认密码！

1. 点击菜单栏 → "用户管理"
2. 选择 admin 用户
3. 点击"修改密码"
4. 设置新密码（至少 6 位）

### 忘记密码

联系管理员重置密码，或：
1. 删除 `data/databases/regulations.db` 文件
2. 重启程序（会重置为默认账户）
3. ⚠️ 注意：会丢失所有数据！

---

## 法规管理

### 添加法规

#### 方法一：手动添加

1. 点击工具栏"新增法规"按钮
2. 填写法规信息：
   - **法规名称**：例如 "IEEE 1547-2018"
   - **法规编号**：例如 "IEEE1547"
   - **国家/地区**：例如 "美国"
   - **版本号**：例如 "2018"
   - **生效日期**：选择日期
   - **描述**：简要说明

3. 上传文档文件：
   - 点击"选择文件"
   - 支持 PDF、Word 文档
   - 文件大小建议不超过 10MB

4. 点击"保存"

#### 方法二：批量导入（管理员）

1. 准备 Excel 文件（使用法规参数模版.xlsx）
2. 点击"批量导入"
3. 选择 Excel 文件
4. 系统自动导入所有法规

### 查看法规

#### 列表视图

- **浏览**：主界面显示所有法规列表
- **排序**：点击列标题排序
- **筛选**：使用顶部筛选器

#### 详情视图

1. 双击法规记录
2. 查看详细信息：
   - 基本信息
   - 文档预览
   - 参数列表
   - 关联代码

### 编辑法规

1. 选中法规记录
2. 点击"编辑"按钮
3. 修改信息
4. 点击"保存"

⚠️ 管理员修改法规后，系统会自动推送通知给所有用户。

### 删除法规

1. 选中法规记录
2. 点击"删除"按钮
3. 确认删除

⚠️ 注意：删除法规会同时删除相关文档和参数。

### 导出法规

#### 导出单个法规

1. 选中法规记录
2. 点击"导出"
3. 选择格式：
   - PDF - 法规文档
   - Excel - 参数数据
   - Word - 完整报告

#### 批量导出

1. 使用 Ctrl/Shift 多选法规
2. 点击"批量导出"
3. 选择格式和保存位置

---

## 代码管理

### 添加代码文件

1. 点击"代码管理"标签页
2. 点击"新增代码"
3. 填写信息：
   - **代码名称**
   - **关联法规**：选择相关法规
   - **文件类型**：C/C++/Header
   - **描述**

4. 上传代码文件（.c, .h, .cpp）
5. 点击"保存"

### 查看代码

1. 在代码列表中双击记录
2. 代码查看器会显示：
   - 语法高亮
   - 行号
   - 关键字标注

### 搜索代码

1. 在搜索框输入关键字
2. 选择"代码内容"搜索范围
3. 点击搜索
4. 查看匹配结果（高亮显示）

### 编辑代码

1. 选中代码记录
2. 点击"编辑"
3. 可修改信息，但不能修改源文件
4. 如需修改源文件：
   - 删除旧记录
   - 重新上传新文件

---

## 搜索功能

### 快速搜索

在主界面顶部搜索框输入关键字，按 Enter。

### 高级搜索

1. 点击"高级搜索"按钮
2. 设置搜索条件：
   - **关键字**：搜索内容
   - **搜索范围**：
     - 法规名称
     - 法规内容
     - 代码文件
     - 全部
   - **国家/地区**：筛选特定国家
   - **日期范围**：限定时间

3. 点击"搜索"

### 搜索技巧

- **精确搜索**：使用双引号 `"IEEE 1547"`
- **多关键字**：空格分隔 `电压 频率`
- **排除关键字**：使用减号 `-draft`

### 查看搜索结果

- **列表显示**：所有匹配项
- **关键字高亮**：黄色标注
- **预览**：点击查看详情
- **导出**：保存搜索结果

---

## 用户管理

### 查看用户列表（管理员）

1. 点击菜单 → "用户管理"
2. 查看所有用户信息：
   - 用户名
   - 角色（管理员/普通用户）
   - 创建时间
   - 最后登录

### 添加用户（管理员）

1. 点击"新增用户"
2. 填写信息：
   - **用户名**：唯一标识
   - **密码**：至少 6 位
   - **角色**：
     - 管理员：完整权限
     - 普通用户：查看和搜索
   - **姓名**：真实姓名（可选）

3. 点击"保存"

### 修改用户（管理员）

1. 选中用户记录
2. 点击"编辑"
3. 修改信息
4. 点击"保存"

### 重置密码（管理员）

1. 选中用户记录
2. 点击"重置密码"
3. 设置新密码
4. 通知用户新密码

### 删除用户（管理员）

1. 选中用户记录
2. 点击"删除"
3. 确认删除

⚠️ 注意：不能删除当前登录的用户。

### 修改自己的密码

1. 点击菜单 → "修改密码"
2. 输入：
   - 旧密码
   - 新密码
   - 确认新密码
3. 点击"确定"

---

## 系统设置

### 版本更新

#### 自动检查

- 程序启动时自动检查
- 每 5 分钟自动检查一次
- 有新版本时弹窗提醒

#### 查看更新

1. 点击工具栏"版本更新"按钮
2. 查看：
   - 当前版本
   - 最新版本
   - 更新日志
3. 点击下载链接获取新版本

#### 更新通知

- **小红点**：按钮显示未读通知数
- **弹窗提醒**：有新更新时自动弹出
- **通知列表**：查看所有历史通知

### 推送更新（管理员）

用于通知所有用户重要信息：

1. 点击工具栏"推送更新"
2. 填写：
   - **通知类型**：软件更新/法规更新
   - **标题**：简短描述
   - **版本号**：（软件更新时填写）
   - **消息内容**：详细说明

3. 点击"推送通知"

所有用户会在下次启动或 5 分钟内收到通知。

### 数据库配置

#### 单机模式（默认）

数据存储在：`程序目录/data/databases/regulations.db`

无需配置，开箱即用。

#### 多用户协作模式

参见《多用户使用说明.md》

简要步骤：
1. 设置网络共享文件夹
2. 修改 `.env` 文件
3. 配置数据库路径
4. 重启程序

### 备份与恢复

#### 备份数据

**方式一：手动备份**
```
复制整个 data 文件夹到安全位置
建议：每周备份一次
```

**方式二：导出数据**
1. 点击菜单 → "导出数据"
2. 选择保存位置
3. 系统导出所有数据为 Excel

#### 恢复数据

**方式一：从备份恢复**
```
1. 关闭程序
2. 删除 data 文件夹
3. 复制备份的 data 文件夹
4. 重启程序
```

**方式二：导入数据**
1. 点击菜单 → "导入数据"
2. 选择备份的 Excel 文件
3. 系统自动导入

---

## 常见问题

### 安装和启动

#### Q: 双击无法启动程序？

**A**: 尝试以下方法：
1. 右键 → 以管理员身份运行
2. 检查杀毒软件是否拦截
3. 添加到杀毒软件白名单
4. 查看 `data/logs/app_main.log` 错误日志

#### Q: 提示缺少 DLL 文件？

**A**: 安装 Visual C++ Redistributable：
```
下载地址: https://aka.ms/vs/17/release/vc_redist.x64.exe
安装后重启程序
```

#### Q: 程序启动很慢？

**A**: 可能原因：
- 首次启动需要初始化数据库（正常）
- 杀毒软件扫描（添加到白名单）
- 磁盘空间不足（清理磁盘）

### 使用问题

#### Q: 无法上传大文件？

**A**:
- 当前限制：10MB
- 建议压缩文件后上传
- 或联系管理员调整限制

#### Q: 搜索没有结果？

**A**: 检查：
1. 关键字拼写是否正确
2. 搜索范围是否正确
3. 筛选条件是否过严
4. 数据库中是否有相关数据

#### Q: 文档预览失败？

**A**: 可能原因：
- 文件格式不支持
- 文件已损坏
- 缺少查看器组件

建议：下载原文件用专业软件查看

### 数据问题

#### Q: 数据突然丢失？

**A**: 检查：
1. 是否误删数据库文件
2. 磁盘空间是否充足
3. 是否有备份文件

恢复：使用最近的备份恢复

#### Q: 多用户模式下数据不同步？

**A**: 检查：
1. 网络共享路径是否正确
2. 所有电脑是否指向同一数据库
3. 网络连接是否稳定

解决：运行《测试数据库连接.bat》诊断

#### Q: 如何迁移数据到新电脑？

**A**:
1. 在旧电脑上备份 `data` 文件夹
2. 在新电脑上安装程序
3. 覆盖新电脑的 `data` 文件夹
4. 重启程序

### 更新问题

#### Q: 没有收到更新通知？

**A**: 检查：
1. 网络连接是否正常
2. 防火墙是否拦截
3. 重启程序触发检查

#### Q: 下载更新失败？

**A**:
1. 检查网络连接
2. 尝试浏览器下载
3. 联系管理员获取安装包

#### Q: 更新后数据会丢失吗？

**A**:
- 不会！数据存储在 `data` 文件夹
- 更新只替换程序文件
- 建议更新前备份（以防万一）

---

## 快捷键

| 快捷键 | 功能 |
|--------|------|
| Ctrl + N | 新增法规 |
| Ctrl + F | 搜索 |
| Ctrl + S | 保存 |
| Ctrl + W | 关闭当前窗口 |
| Ctrl + Q | 退出程序 |
| F5 | 刷新列表 |
| Delete | 删除选中项 |
| Ctrl + A | 全选 |
| Ctrl + C | 复制 |

---

## 权限说明

### 管理员权限

- ✅ 所有查看功能
- ✅ 添加/编辑/删除法规
- ✅ 添加/编辑/删除代码
- ✅ 用户管理
- ✅ 推送更新通知
- ✅ 系统配置
- ✅ 数据导入/导出

### 普通用户权限

- ✅ 查看法规和代码
- ✅ 搜索功能
- ✅ 导出数据
- ✅ 修改自己的密码
- ❌ 不能添加/编辑/删除数据
- ❌ 不能管理用户
- ❌ 不能推送通知

---

## 最佳实践

### 日常使用

1. **定期备份**
   - 每周备份一次 data 文件夹
   - 重要操作前先备份

2. **及时更新**
   - 收到更新通知后尽快更新
   - 阅读更新日志了解新功能

3. **正确退出**
   - 使用"退出"按钮关闭程序
   - 不要直接关闭窗口或强制结束

4. **数据整理**
   - 定期清理无用数据
   - 保持法规信息准确完整

### 多用户协作

1. **统一配置**
   - 所有电脑使用相同的数据库路径
   - 统一软件版本

2. **避免冲突**
   - 不要同时编辑同一条记录
   - 修改后及时保存

3. **权限分配**
   - 合理分配管理员和普通用户
   - 定期审查用户权限

4. **沟通协调**
   - 重要操作前通知其他用户
   - 建立数据管理规范

---

## 技术支持

### 获取帮助

1. **查看文档**
   - README.md - 项目说明
   - 本手册 - 使用指南
   - 多用户使用说明.md - 协作指南

2. **查看日志**
   ```
   位置: data/logs/app_main.log
   记录所有操作和错误信息
   ```

3. **联系支持**
   - GitHub Issues: https://github.com/rockbing2125/Safety-Manager/issues
   - 邮件: [您的联系邮箱]
   - 企业内部：联系IT部门

### 问题反馈

提交问题时请提供：
1. 问题描述（详细）
2. 操作步骤
3. 错误截图
4. 日志文件（app_main.log）
5. 系统信息（Windows 版本）

---

## 附录

### 文件结构

```
SafetyManager/
├── SafetyManager.exe      # 主程序
├── _internal/             # 依赖文件
├── data/                  # 数据目录
│   ├── databases/         # 数据库文件
│   ├── documents/         # 法规文档
│   ├── codes/             # 代码文件
│   └── logs/              # 日志文件
└── .env                   # 配置文件（可选）
```

### 数据库表结构

- **users** - 用户信息
- **regulations** - 法规信息
- **parameters** - 法规参数
- **code_files** - 代码文件
- **update_notifications** - 更新通知
- **history** - 操作历史

### 支持的文件格式

**文档**:
- PDF (.pdf)
- Word (.docx, .doc)

**代码**:
- C (.c)
- C++ (.cpp)
- Header (.h, .hpp)

**导出**:
- Excel (.xlsx)
- PDF (.pdf)
- Word (.docx)

---

## 版本历史

### v1.0.0 (2025-12-02)
- 初始发布版本
- 法规文档管理
- 代码文件管理
- 用户权限管理
- 自动版本更新
- 单机和协作模式

---

## 致谢

感谢使用 Safety Manager！

如有建议或问题，欢迎反馈。

---

**祝您使用愉快！** 🎉
