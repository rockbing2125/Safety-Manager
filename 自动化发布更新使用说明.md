# 自动化发布更新使用说明

## 🚀 新功能特性

现在您只需要在软件中点击几下，就能完成整个发布流程！无需手动创建 Release，无需手动上传文件。

---

## ✨ 自动化功能

### 软件会自动帮您完成：

1. ✅ **创建 GitHub Release** - 自动创建对应版本的 Release
2. ✅ **上传安装包** - 自动上传您选择的 zip/rar 文件
3. ✅ **生成下载链接** - 自动获取文件下载地址
4. ✅ **更新 version.json** - 自动写入版本信息和下载链接
5. ✅ **推送到 GitHub** - 自动提交并推送更新
6. ✅ **通知用户** - 用户启动时自动收到更新提示

---

## 📋 完整操作流程

### 步骤1：准备发布包（2分钟）

#### 方法A：使用现有的打包文件

如果您已经有 `dist\SafetyManager.rar`：

1. 重命名为：`SafetyManager_v版本号.zip`
2. 例如：`SafetyManager_v1.1.5.zip`

#### 方法B：重新打包

1. 进入 `dist\SafetyManager` 目录
2. 选中所有文件
3. 右键 → 发送到 → 压缩(zipped)文件夹
4. 重命名为：`SafetyManager_v1.1.5.zip`

**注意事项：**
- ✅ 建议使用 **.zip** 格式（Windows 原生支持）
- ✅ 文件名格式：`SafetyManager_v版本号.zip`
- ⚠️ 确保文件小于 **100MB**（GitHub限制）

---

### 步骤2：使用"GitHub推送"功能（3分钟）

1. **打开软件** → 登录管理员账号

2. **点击工具栏** → **"GitHub 推送"**

3. **填写发布信息：**

   | 字段 | 说明 | 示例 |
   |------|------|------|
   | **新版本号** | 不带v的版本号 | `1.1.5` |
   | **发布文件** | 点击"选择文件..."按钮，选择打包好的 zip 文件 | `SafetyManager_v1.1.5.zip` |
   | **更新日志** | 每行一条更新内容 | `✨ 新增自动化发布功能`<br>`🐛 修复数据同步问题` |
   | **GitHub Token** | 您的访问令牌 | `ghp_xxxxxxxxxxxxx` |
   | **强制更新** | 可选，勾选则用户必须更新 | 一般不勾选 |
   | **同步更新 config.py** | 建议勾选 | ✅ 已勾选 |

4. **点击"推送到 GitHub"**

5. **确认信息**：
   ```
   确定要推送版本 v1.1.5 到 GitHub 吗？

   此操作将：
   1. 创建 GitHub Release (v1.1.5)
   2. 上传文件: SafetyManager_v1.1.5.zip (35.67 MB)
   3. 更新 version.json 文件
   4. 提交并推送到 GitHub
   5. 用户将自动收到更新通知

   ⚠️ 上传可能需要几分钟，请耐心等待。
   ```

6. **等待完成**（根据文件大小，可能需要1-5分钟）

7. **完成提示**：
   ```
   🎉 版本 1.1.5 发布成功！
   下载链接: https://github.com/...

   ✅ GitHub Release 已创建
   ✅ 安装包已上传
   ✅ version.json 已更新

   用户将在启动程序时自动收到更新通知。
   ```

---

### 步骤3：验证发布（1分钟）

#### 验证 Release

访问：https://github.com/rockbing2125/Safety-Manager/releases

应该能看到：
- 新的 Release：`SafetyManager v1.1.5`
- 上传的文件：`SafetyManager_v1.1.5.zip`
- 更新日志内容

#### 验证 version.json

访问：https://github.com/rockbing2125/Safety-Manager/blob/main/version.json

应该看到：
```json
{
  "version": "1.1.5",
  "release_date": "2025-12-03",
  "download_url": "https://github.com/rockbing2125/Safety-Manager/releases/download/v1.1.5/SafetyManager_v1.1.5.zip",
  "changelog": [
    "✨ 新增自动化发布功能",
    "🐛 修复数据同步问题"
  ],
  "required": false,
  "min_version": "1.0.0"
}
```

#### 测试用户更新

在另一台电脑上（或卸载重装旧版本）：
1. 打开旧版本程序
2. 程序启动时自动检查更新
3. 显示"发现新版本"对话框
4. 用户可选择下载更新

---

## 🔧 GitHub Token 获取方法

### 首次设置（5分钟）

1. **访问 GitHub Token 页面**：
   ```
   https://github.com/settings/tokens
   ```

2. **创建新 Token**：
   - 点击 **"Generate new token"**
   - 选择 **"Generate new token (classic)"**

3. **填写信息**：
   ```
   Note（备注）: SafetyManager Release Publishing
   Expiration（过期时间）: No expiration（不过期）
   ```

4. **选择权限**（重要！）：
   - ✅ **repo** - 完整的仓库控制权限（展开并全选）
     - ✅ repo:status
     - ✅ repo_deployment
     - ✅ public_repo
     - ✅ repo:invite
     - ✅ security_events
   - ✅ **workflow** - 更新 GitHub Actions 工作流

5. **生成并保存 Token**：
   - 点击底部 **"Generate token"**
   - 复制生成的 Token（`ghp_xxxxxxxxxxxxxx`）
   - ⚠️ **立即保存！只显示一次！**

6. **安全保存 Token**：
   - 保存到密码管理器
   - 或者保存到安全的文本文件
   - 不要分享给他人

---

## ❓ 常见问题

### Q1：上传失败，提示"unauthorized"

**原因：** Token 权限不足

**解决：**
1. 重新创建 Token
2. 确保勾选了 `repo` 的所有权限
3. 删除旧 Token，使用新 Token

### Q2：上传很慢或超时

**原因：** 文件太大或网络不稳定

**解决：**
- 检查文件大小（建议 < 50MB）
- 使用稳定的网络连接
- 如果超时，可以重新上传（会覆盖）

### Q3：提示"Release already exists"

**原因：** 该版本号的 Release 已存在

**解决：**
- 软件会自动更新现有 Release
- 或者使用新的版本号

### Q4：用户下载后无法解压

**原因：** 文件格式或打包问题

**建议：**
- 使用 .zip 格式（兼容性最好）
- 确保压缩文件完整
- 测试压缩包能否正常解压

### Q5：如何删除错误的 Release？

**方法：**
1. 访问：https://github.com/rockbing2125/Safety-Manager/releases
2. 找到要删除的 Release
3. 点击右上角的 **"Delete"** 按钮
4. 重新发布正确的版本

---

## 🎯 最佳实践

### 发布前检查清单

- [ ] 程序功能测试完成
- [ ] 打包文件已准备（.zip格式）
- [ ] 文件名正确：`SafetyManager_v版本号.zip`
- [ ] 版本号递增（如 1.1.4 → 1.1.5）
- [ ] 更新日志填写完整
- [ ] GitHub Token 有效且权限充足
- [ ] 网络连接稳定

### 版本号管理

**格式：** `主版本号.次版本号.修订号`

**示例：**
- `1.0.0` - 首个正式版本
- `1.1.0` - 新增功能
- `1.1.1` - Bug 修复
- `2.0.0` - 重大更新

**递增规则：**
- 重大更新 → 主版本号+1
- 新增功能 → 次版本号+1
- Bug 修复 → 修订号+1

### 更新日志编写

**推荐格式：**
```
✨ 新增自动化发布功能
✨ 新增数据导入导出
🐛 修复 Git 检查超时问题
🔧 优化版本更新逻辑
⚡ 提升启动速度
🎨 改进用户界面
📚 完善使用文档
```

**图标说明：**
- ✨ 新功能
- 🐛 Bug修复
- 🔧 优化改进
- ⚡ 性能提升
- 🎨 UI改进
- 📚 文档更新
- 🔒 安全修复

---

## 📊 与旧方法的对比

| 项目 | 旧方法（手动） | 新方法（自动） |
|------|---------------|----------------|
| 创建 Release | 需要手动在 GitHub 网页创建 | ✅ 自动创建 |
| 上传文件 | 需要手动拖拽上传 | ✅ 自动上传 |
| 获取下载链接 | 需要手动复制链接 | ✅ 自动生成 |
| 更新 version.json | 需要手动填写和推送 | ✅ 自动更新 |
| 所需时间 | 约10-15分钟 | ⏱️ 约3-5分钟 |
| 出错可能 | 较高（手动操作多） | ⏬ 较低（自动化） |

---

## 🔗 相关链接

| 资源 | 链接 |
|------|------|
| **GitHub 仓库** | https://github.com/rockbing2125/Safety-Manager |
| **Releases 列表** | https://github.com/rockbing2125/Safety-Manager/releases |
| **创建 Token** | https://github.com/settings/tokens |
| **version.json** | https://github.com/rockbing2125/Safety-Manager/blob/main/version.json |

---

## 🆘 获取帮助

遇到问题时：

1. 查看软件日志：`logs/` 目录
2. 运行诊断工具：`python check_git_env.py`
3. 查看 GitHub 仓库的 Issues
4. 查看详细文档：《Git数据同步使用说明.md》

---

**最后更新：** 2025-12-03
**当前版本：** v1.1.5+
**功能状态：** ✅ 已实现并测试

---

## 📝 更新记录

- **2025-12-03：** 实现自动化发布功能
  - 自动创建 GitHub Release
  - 自动上传发布文件
  - 自动生成下载链接
  - 简化发布流程
