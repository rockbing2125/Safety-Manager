# 并网法规管理系统 - 分发说明

## 📦 打包步骤

### 1. 配置更新服务器地址

在打包前，需要在 `shared/config.py` 中配置你的云服务器地址：

```python
# 版本更新配置
UPDATE_CHECK_URL: str = Field(
    default="http://你的服务器地址/api/version/check",  # 👈 修改这里
    env="UPDATE_CHECK_URL"
)
UPDATE_DOWNLOAD_URL: str = Field(
    default="http://你的服务器地址/api/version/download",  # 👈 修改这里
    env="UPDATE_DOWNLOAD_URL"
)
```

### 2. 运行打包脚本

```bash
build.bat
```

打包完成后，可执行文件位于：`dist\SafetyManager\SafetyManager.exe`

### 3. 测试打包结果

运行 `dist\SafetyManager\SafetyManager.exe` 验证：
- ✅ 程序能正常启动
- ✅ 自动创建数据库（`data/databases/regulations.db`）
- ✅ 默认管理员账户可以登录（admin / admin123）
- ✅ 版本更新功能正常工作

### 4. 打包分发

将整个 `dist\SafetyManager\` 文件夹压缩成 zip 文件，发送给用户。

---

## 🚀 用户使用指南

### 快速开始

1. **解压文件夹**
   - 将收到的 zip 文件解压到任意位置
   - 例如：`D:\SafetyManager\`

2. **直接运行**
   - 双击 `SafetyManager.exe` 启动程序
   - 首次运行会自动：
     - 创建本地数据库
     - 初始化系统
     - 创建默认管理员账户

3. **登录系统**
   - 用户名：`admin`
   - 密码：`admin123`
   - 首次登录后请修改密码

### 自动更新功能

程序已内置版本更新推送功能：

- **自动检查**：程序会定期检查新版本
- **更新通知**：有新版本时会在系统中显示通知
- **一键更新**：点击通知即可下载并安装更新

> 💡 **提示**：确保电脑能访问互联网以接收更新推送

### 数据存储

- **默认位置**：`程序目录/data/databases/regulations.db`
- **独立存储**：每台电脑的数据互不影响
- **备份建议**：定期备份 `data` 文件夹

---

## 🔧 高级配置（可选）

如需自定义配置，可以使用配置文件：

### 1. 创建配置文件

将 `.env.dist` 重命名为 `.env`

### 2. 修改配置项

打开 `.env` 文件，根据需要修改：

```bash
# 多用户协作（网络共享数据库）
DATABASE_PATH=\\192.168.1.100\SafetyManager\regulations.db

# 自定义更新服务器
UPDATE_CHECK_URL=http://your-server.com/api/version/check

# 日志级别
LOG_LEVEL=INFO
```

### 3. 重启程序

修改配置后，重启程序使配置生效。

---

## ❓ 常见问题

### 程序无法启动

1. 检查是否有杀毒软件拦截
2. 尝试以管理员身份运行
3. 查看 `data/logs/app_main.log` 日志文件

### 无法接收更新推送

1. 检查网络连接是否正常
2. 确认更新服务器地址配置正确
3. 查看日志文件中的错误信息

### 数据丢失

1. 检查 `data/databases/` 目录下的数据库文件是否存在
2. 恢复之前备份的 `data` 文件夹

### 忘记密码

联系管理员重置密码，或重新安装程序（会清空所有数据）。

---

## 📞 技术支持

如遇到问题，请提供以下信息：

- 操作系统版本
- 程序版本号
- 错误截图
- 日志文件（`data/logs/app_main.log`）

---

## 🔄 版本历史

### v1.0.0
- ✨ 初始发布版本
- ✅ 支持离线单机运行
- ✅ 自动数据库初始化
- ✅ 内置版本更新推送
- ✅ 开箱即用，无需配置
