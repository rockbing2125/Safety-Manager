# 软件分发完整指南

## 概述

本指南介绍如何将软件打包并分发给其他用户使用。

---

## 第一步：打包软件

### 1.1 运行打包脚本

在项目根目录执行：

```bash
build.bat
```

### 1.2 等待打包完成

打包过程需要几分钟，完成后会在 `dist/SafetyManager/` 目录生成可执行文件。

### 1.3 检查打包结果

```bash
# 检查可执行文件
dir dist\SafetyManager\SafetyManager.exe

# 测试运行
dist\SafetyManager\SafetyManager.exe
```

确认程序能正常启动后再继续。

---

## 第二步：创建分发包

### 2.1 准备分发文件夹

将以下文件复制到一个新文件夹（例如：`SafetyManager_v1.0.0`）：

**必需文件**：
```
SafetyManager_v1.0.0/
├── SafetyManager.exe          # 从 dist/SafetyManager/ 复制
├── _internal/                 # 从 dist/SafetyManager/ 复制整个文件夹
├── 使用说明.txt               # 创建简单的使用说明
└── .env.dist                  # 配置示例（可选）
```

### 2.2 创建使用说明.txt

```text
===============================================
    并网法规管理系统 v1.0.0 使用说明
===============================================

【快速开始】
1. 双击 SafetyManager.exe 启动程序
2. 首次运行会自动创建数据库
3. 使用默认账户登录：
   用户名：admin
   密码：admin123
4. 登录后请立即修改密码

【系统要求】
- Windows 10 或更高版本
- 无需安装 Python
- 无需其他依赖

【数据存储】
- 数据存储在：程序目录/data/databases/
- 建议定期备份 data 文件夹

【自动更新】
- 程序会自动检查版本更新
- 有新版本时会弹窗提醒
- 点击下载链接获取最新版本

【多用户协作】
如需多台电脑共享数据：
1. 设置网络共享文件夹
2. 修改 .env 配置文件
3. 详见《多用户使用说明.md》

【获取帮助】
- 技术支持：[您的联系方式]
- 项目地址：https://github.com/rockbing2125/Safety-Manager

【版本历史】
v1.0.0 (2025-12-02)
- 初始发布版本
- 支持离线单机运行
- 法规文档管理
- 代码文件管理
- 自动版本更新

===============================================
```

### 2.3 压缩分发包

将整个 `SafetyManager_v1.0.0` 文件夹压缩成 zip 格式：

```bash
# Windows 右键菜单
右键点击文件夹 → 发送到 → 压缩(zipped)文件夹

# 或使用命令行
powershell Compress-Archive -Path SafetyManager_v1.0.0 -DestinationPath SafetyManager_v1.0.0.zip
```

---

## 第三步：发布到 GitHub Releases

### 3.1 创建新的 Release

1. 访问 GitHub 仓库：
   ```
   https://github.com/rockbing2125/Safety-Manager/releases
   ```

2. 点击 **"Draft a new release"** 或 **"Create a new release"**

### 3.2 填写 Release 信息

**Tag version**（标签版本）:
```
v1.0.0
```

**Release title**（发布标题）:
```
Safety Manager v1.0.0 - 初始发布版本
```

**Describe this release**（描述）:
```markdown
## 并网法规管理系统 v1.0.0

### ✨ 主要功能

- 📁 法规文档管理
  - 支持 PDF、Word 文档导入
  - 快速搜索和查看
  - 法规参数提取和管理

- 💻 代码文件管理
  - C/C++ 代码文件支持
  - 代码查看和搜索
  - 关联法规参数

- 👥 用户权限管理
  - 管理员和普通用户角色
  - 操作日志记录
  - 安全认证

- 🔄 自动版本更新
  - 启动时自动检查更新
  - 更新提醒和下载
  - 无需手动检查

- 🗄️ 灵活的数据存储
  - 支持单机离线运行
  - 支持网络共享数据库
  - 多用户协作

### 📦 安装说明

1. 下载下方的 `SafetyManager_v1.0.0.zip`
2. 解压到任意位置
3. 双击 `SafetyManager.exe` 启动
4. 默认账户：admin / admin123

### 💡 使用建议

- 首次登录后请修改默认密码
- 定期备份 `data` 文件夹
- 查看压缩包内的《使用说明.txt》

### 📝 更新日志

- ✨ 初始发布版本
- ✅ 支持离线单机运行
- ✅ 自动数据库初始化
- ✅ 内置版本更新推送
- ✅ 开箱即用，无需配置

### 🔗 相关链接

- 项目主页: https://github.com/rockbing2125/Safety-Manager
- 问题反馈: https://github.com/rockbing2125/Safety-Manager/issues
- 使用文档: 查看仓库中的 README.md

### 📊 系统要求

- Windows 10 或更高版本
- 推荐内存: 4GB 及以上
- 磁盘空间: 200MB

---

**注意**: 这是初始发布版本，如遇到问题请及时反馈。
```

### 3.3 上传分发包

在 **"Attach binaries"** 区域：

1. 点击 **"Attach files by dropping them here or selecting them"**
2. 选择刚才创建的 `SafetyManager_v1.0.0.zip` 文件
3. 等待上传完成

### 3.4 发布 Release

1. 确认信息无误
2. 点击 **"Publish release"** 按钮
3. Release 创建成功！

### 3.5 获取下载链接

发布成功后，右键点击 zip 文件，复制下载链接，格式类似：

```
https://github.com/rockbing2125/Safety-Manager/releases/download/v1.0.0/SafetyManager_v1.0.0.zip
```

---

## 第四步：分发给用户

### 方式一：通过 GitHub（推荐）

**优点**：
- 免费托管
- 自动版本管理
- 稳定可靠

**步骤**：
1. 分享 Release 页面链接给用户：
   ```
   https://github.com/rockbing2125/Safety-Manager/releases/latest
   ```
2. 用户点击下载 zip 文件
3. 解压并运行

### 方式二：通过云盘分享

**适用场景**：
- GitHub 访问不便
- 需要更快的下载速度（国内用户）

**推荐平台**：
- 百度网盘
- 阿里云盘
- 腾讯微云
- OneDrive

**步骤**：
1. 上传 zip 文件到云盘
2. 创建分享链接
3. 发送给用户

### 方式三：企业内网

**适用场景**：
- 企业内部使用
- 需要控制访问权限

**步骤**：
1. 上传到企业文件服务器
2. 设置访问权限
3. 通知用户下载路径

---

## 第五步：用户安装指南

为用户提供以下说明：

```text
【安装步骤】

1. 下载软件
   - 方式一：从 GitHub 下载
     https://github.com/rockbing2125/Safety-Manager/releases/latest
   - 方式二：从共享链接下载（如有）

2. 解压文件
   - 右键点击 zip 文件 → 解压到文件夹
   - 建议解压到：C:\Program Files\SafetyManager\

3. 首次运行
   - 双击 SafetyManager.exe
   - 程序会自动初始化数据库
   - 等待几秒钟直到登录界面出现

4. 登录系统
   - 用户名：admin
   - 密码：admin123
   - 登录后请立即修改密码

5. 开始使用
   - 添加法规文档
   - 导入代码文件
   - 管理用户（管理员功能）

【常见问题】

Q: 双击无法启动？
A: 尝试以管理员身份运行，或检查杀毒软件是否拦截

Q: 数据存储在哪里？
A: 程序目录下的 data 文件夹

Q: 如何备份数据？
A: 复制整个 data 文件夹即可

Q: 如何更新软件？
A: 程序会自动提醒更新，下载新版本后覆盖安装即可
```

---

## 第六步：配置自动更新

### 6.1 确认 version.json 已配置

确保你的 `version.json` 文件内容正确：

```json
{
  "version": "1.0.0",
  "release_date": "2025-12-02",
  "download_url": "https://github.com/rockbing2125/Safety-Manager/releases/download/v1.0.0/SafetyManager_v1.0.0.zip",
  "changelog": [
    "✨ 初始发布版本",
    "✅ 支持离线单机运行",
    "✅ 自动数据库初始化",
    "✅ 内置版本更新推送",
    "✅ 开箱即用，无需配置"
  ],
  "required": false,
  "min_version": "1.0.0"
}
```

### 6.2 提交并推送

```bash
git add version.json
git commit -m "发布 v1.0.0 版本"
git push
```

### 6.3 测试自动更新

1. 让其他用户安装并运行程序
2. 程序启动时会自动检查更新
3. 每 5 分钟检查一次
4. 发现新版本时显示更新通知

---

## 常见问题

### Q1: 打包后文件太大怎么办？

**A**: 正常情况，因为包含了 Python 运行时和所有依赖：
- 正常大小：150-200MB
- 如需减小：考虑使用安装程序（Inno Setup）

### Q2: 用户电脑缺少 DLL 怎么办？

**A**: PyInstaller 已包含所需的所有 DLL，如果仍然缺少：
1. 安装 Visual C++ Redistributable
2. 下载地址：https://aka.ms/vs/17/release/vc_redist.x64.exe

### Q3: 杀毒软件误报怎么办？

**A**: PyInstaller 打包的程序可能被误报：
1. 添加到杀毒软件白名单
2. 提交样本给杀毒软件厂商
3. 考虑购买代码签名证书

### Q4: 如何实现静默自动更新？

**A**: 当前版本需要用户手动下载：
1. 程序检测到更新后显示通知
2. 用户点击下载链接
3. 手动下载并安装
4. 未来版本可以增加自动下载功能

### Q5: 可以多语言版本吗？

**A**: 当前是中文版本，如需多语言：
1. 使用 i18n 库
2. 创建语言文件
3. 重新打包

---

## 最佳实践

### 版本命名规范

遵循语义化版本（Semantic Versioning）：
- **主版本号**: 不兼容的重大更改（1.0.0 → 2.0.0）
- **次版本号**: 向下兼容的新功能（1.0.0 → 1.1.0）
- **修订号**: 向下兼容的问题修正（1.0.0 → 1.0.1）

示例：
- v1.0.0 - 初始版本
- v1.0.1 - 修复 bug
- v1.1.0 - 新增功能
- v2.0.0 - 重大更新

### 发布前检查清单

- [ ] 代码已测试无误
- [ ] 版本号已更新
- [ ] version.json 已更新
- [ ] CHANGELOG 已更新
- [ ] 打包文件完整
- [ ] 测试运行正常
- [ ] 文档已更新
- [ ] GitHub Release 已创建

### 用户沟通

**发布通知模板**：

```
【新版本发布】Safety Manager v1.0.0

各位用户好！

Safety Manager v1.0.0 正式发布了！

主要更新：
✨ 初始发布版本
✅ 法规文档管理
✅ 代码文件管理
✅ 自动版本更新

下载地址：
https://github.com/rockbing2125/Safety-Manager/releases/tag/v1.0.0

安装说明：
1. 下载 SafetyManager_v1.0.0.zip
2. 解压到任意位置
3. 运行 SafetyManager.exe
4. 默认账户: admin / admin123

如有问题，请及时反馈！

感谢使用！
```

---

## 相关文档

- **版本更新推送流程**: 查看《版本更新推送完整流程.md》
- **GitHub 配置**: 查看《GitHub版本更新配置指南.md》
- **多用户协作**: 查看《多用户使用说明.md》
- **打包配置**: 查看 `SafetyManager.spec` 和 `build.bat`

---

## 技术支持

如遇到问题：
1. 查看项目文档
2. 提交 GitHub Issue
3. 联系维护人员

---

**准备好了吗？开始分发你的软件吧！** 🚀
